name: "Compile"

on:
    push:
        branches:
            - bugfix/frw-1790-fix-phar-compilation
    workflow_dispatch:

jobs:
    build:
        name: Build
        if: ${{ 'success' == 'success' }}
        runs-on: "ubuntu-latest"
        timeout-minutes: 60

        steps:
            - name: Checkout
              uses: actions/checkout@v3
              with:
                  ref: bugfix/frw-1790-fix-phar-compilation
                  fetch-depth: 0

            - name: Install PHP
              uses: shivammathur/setup-php@v2
              with:
                  coverage: "none"
                  php-version: "8.1"

            - name: Composer install
              run: composer install --no-interaction --no-progress

            - name: Build caches and compile the PHAR
              run: bin/console spryk:compile

            - uses: actions/upload-artifact@v3
              with:
                  name: phar-file
                  path: tmp/spryk.phar

            - name: Delete PHAR
              run: rm tmp/spryk.phar
